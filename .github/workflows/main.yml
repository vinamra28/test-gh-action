on: [ push ]

env:
  IMAGE_NAME: hello-world
  TAGS: latest v1

jobs:
  test_s2i:
    runs-on: ubuntu-latest
    name: A job to install s2i
    steps:
      # Checkout hello-world repository for testing
      - name: Checkout application
        uses: actions/checkout@v2
        with:
          repository: 'go-training/helloworld'

      # Install s2i
      - name: Install s2i
        uses: redhat-actions/openshift-tools-installer@v1
        with:
          source: github
          s2i: latest

      - name: Test s2i version
        run: s2i version

        # Build container image
      - name: Build
        id: build_image
        uses: redhat-actions/s2i-build@v1
        with:
          builder_image: 'registry.access.redhat.com/devtools/go-toolset-rhel7'
          image: ${{ env.IMAGE_NAME }}
          tags: ${{ env.TAGS }}

      - name: Echo Outputs
        run: |
          echo "Image: ${{ steps.build_image.outputs.image }}"
          echo "Tags: ${{ steps.build_image.outputs.tags }}"

      # Run image to verify the build
      - name: Run image
        run: docker run ${{ env.IMAGE_NAME}}:latest
